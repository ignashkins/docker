version: '3'

services:
    database:
        container_name: bitrix-database
        restart: unless-stopped
        image: mysql:5.7
        environment:
            MYSQL_DATABASE: sitemanager
            MYSQL_ROOT_PASSWORD: bitrix
            MYSQL_PASSWORD: bitrix
            MYSQL_USER: bitrix
            SERVICE_TAGS: dev
            SERVICE_NAME: mysql
        networks:
            - bitrix
        ports:
            - 3306:3306
        volumes:
            - ./database/data:/var/lib/mysql
            - ./database/fresh.sql:/var/lib/mysql/fresh.sql
    nginx:
        image: bitrix-nginx
        privileged: true
        container_name: bitrix-nginx
        build:
            context: ./
            dockerfile: nginx/Dockerfile
        networks:
            - bitrix
        ports:
            - 80:80
            - 8895:8895
        volumes:
            - ./nginx/conf:/etc/nginx
            - ./www:/home/bitrix/www
            - ./bitrixenv_error:/var/www/bitrixenv_error
    apache:
        image: php7apache
        privileged: true
        container_name: bitrix-apache
        # restart: unless-stopped
        build:
            context: ./
            dockerfile: apache/Dockerfile
        networks:
            - bitrix
        volumes:
            - ./www:/home/bitrix/www
            - ./apache/conf:/etc/httpd
            - ./apache/php.d:/etc/php.d
        ports:
            - 8888:8888
            - 8887:8887
            - 9887:9887
    push-server:
        image: bitrix-node
        container_name: bitrix-node
        networks:
            - bitrix
        ports:
            - 8010:8010
            - 8011:8011
            - 8012:8012
            - 8013:8013
            - 8014:8014
            - 8015:8015
            - 9010:9010
            - 9011:9011
networks:
    bitrix:
        driver: bridge